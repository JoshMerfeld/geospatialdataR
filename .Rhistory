theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(5179))
11.285 + 13.735
sqrt(25)
ggplot() +
geom_spatvector(data = intersection, aes(fill = CTP_ENG_NM)) +
scale_fill_brewer("Province", palette = "Set3") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(5179))
length(unique(intersection$CTP_ENG_NM))
kgrid
intersection
kgrid$id==intersection$id
# same order!
kgrid <- kgrid[match(intersection$id, kgrid$id),]
kgrid$id==intersection$id
min(kgrid$id==intersection$id)
kgrid$CTP_ENG_NM <- intersection$CTP_ENG_NM
ggplot() +
geom_spatvector(data = kgrid, aes(fill = CTP_ENG_NM)) +
scale_fill_brewer("Province", palette = "Set3") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(5179))
# also create a continuous value for the province
kgrid$prov <- as.numeric(as.factor(kgrid$CTP_ENG_NM))
table(kgrid$prov)
ggplot() +
geom_spatvector(data = kgrid, aes(fill = prov), show.legend = FALSE) +
scale_fill_distiller("Province", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(5179))
min(intersection$id==kgrid$id)
match(intersection$id, kgrid$id)
?grid
?terra::grid
mw3 <- vect("/Users/Josh/Dropbox/KDIS/Classes/geospatialdataR/week4files/mw3.shp")
mw3
ggplot(mw3) + geom_spatvector()
mwgrid <- rast(mw3, res = 5)
mwgrid
mwgrid <- rast(mw3, res = 5000)
mwgrid <- rast(mw3, res = 500)
mwgrid
ggplot(mwgrid) + geom_spatraster()
mwgrid
mwgrid$id <- 1:nrow(mwgrid)
mwgrid
ggplot(mwgrid) + geom_spatraster()
ggplot(mwgrid) + geom_spatraster(aes(fill = id))
ggplot(data = mwgrid) + geom_spatraster(aes(fill = id))
ggplot() + geom_spatraster(data = mwgrid, aes(fill = id))
mwgrid <- as.polygons(mwgrid)
ggplot() + geom_spatvector(data = mwgrid)
intersect <- intersect(mwgrid, mw3)
mwgrid <- mwgrid[mwgrid$id %in% intersect$id,]
mwgrid
intersect
unique(intersect$DIST_CODE)
sum(is.na(intersect$DIST_CODE))
mwgrid
ggplot() + geom_spatvector(data = mwgrid)
intersect
length(unique(intersect$id))
mwgrid
ggplot() + geom_spatvector(data = intersect, aes(fill = as.factor(DIST_CODE)))
intersect <- aggregate(intersect, "id")
nrow(intersect)
ggplot() + geom_spatvector(data = intersect, aes(fill = as.factor(DIST_CODE)))
View(as.data.frame(intersect))
writeVect(intersect, "week4files/mwgrid.shp")
saveVect(intersect, "week4files/mwgrid.shp")
writeVector(intersect, "week4files/mwgrid.shp")
writeVector(intersect, "week4files/mwgrid.shp")
getwd()
setwd("~/Dropbox/KDIS/Classes/geospatialdataR")
writeVector(intersect, "week4files/mwgrid.shp", overwrite = TRUE)
mwgrid <- rast(mw3, res = 500)
mwgrid
mwgrid <- as.polygons(mwgrid)
mwgrid
intersect <- intersect(mwgrid, mw3)
mwgrid
intersect
mwgrid$id <- 1:nrow(mwgrid)
intersect <- intersect(mwgrid, mw3)
mw2 <- vect("week4files/mw2.shp")
mw2
mwgrid <- rast(mw2, res = 5000)
mwgrid
mw2
mw2 <- project(mw2, crs(intersect))
mw2
mwgrid
mwgrid <- rast(mw2, res = 5000)
mwgrid
intersection <- intersect(mwgrid, mw2)
mwgrid
mwgrid <- as.polygons(mwgrid)
mwgrid$id <- 1:nrow(mwgrid)
mwgrid
75*40
intersection <- intersect(mwgrid, mw2)
mwgrid <- mwgrid[mwgrid$id %in% intersection$id, ]
mwgrid
ggplot() + geom_spatvector(data = mwgrid)
writeVector(mwgrid, "week4files/mwgrid.shp", overwrite = TRUE)
mwgrid <- vect("week4files/mwgrid.shp")
ggplot() +
geom_spatvector(data = mwgrid) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(5179))
ggplot() +
geom_spatvector(data = mwgrid) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
mwgrid <- vect("week4files/mwgrid.shp")
mw2 <- vect("week4files/mw2.shp")
crs(mwgrid)
mwgrid <- project(mwgrid, "EPSG:4326")
mwgrid
crs(mwgrid)
writeVector(mwgrid, "week4files/mwgrid.shp", overwrite = TRUE)
mwgrid <- vect("week4files/mwgrid.shp")
mw2 <- vect("week4files/mw2.shp")
mwgrid <- project(mwgrid, crs(mw2))
mwgrid
mw2
mwgrid <- vect("week4files/mwgrid.shp")
mw2 <- vect("week4files/mw2.shp")
mw2
mwgrid
intersection <- intersect(mwgrid, mw2)
dim(mwgrid)
dim(intersection)
dim(mwgrid)
intersection$area <- expanse(intersection)
intersection
# keep largest only
intersection <- intersection |>
group_by(id) |>
filter(area==max(area)) |>
ungroup()
intersection
intersection(match(intersection$id, mwgrid$id),]$DISTRICT
intersection[match(intersection$id, mwgrid$id),]$DISTRICT
intersection
match(intersection$id, mwgrid$id)
mwgrid
arrange(mwgrid$id)
order(mwgrid$id)
intersection <- intersection[arrange(intersection$id),]
intersection
intersection
# keep largest only
intersection <- intersection |>
group_by(id) |>
filter(area==max(area)) |>
ungroup() |>
order(id)
intersection <- intersect(mwgrid, mw2)
intersection <- intersect(mwgrid, mw2)
dim(mwgrid) # 1,237 features
dim(mwgrid) # 1,237 features
dim(intersection) # 1,383 features
intersection$area <- expanse(intersection)
# keep largest only
intersection <- intersection |>
group_by(id) |>
filter(area==max(area)) |>
ungroup() |>
order(id)
# keep largest only
intersection <- intersection |>
group_by(id) |>
filter(area==max(area)) |>
ungroup() |>
arrange(id)
intersection
#| echo: false
#| include: true
#| eval: true
#| fig-align: center
#| crop: true
# here's a different way to do it
mwgrid <- mwgrid |>
arrange(id)
intersection <- intersection |>
arrange(id)
# double check
min(mwgrid$id==intersection$id)
mwgrid$district <- intersection$DIST_CODE
mwgrid
ggplot() +
geom_spatvector(data = mwgrid, aes(fill = as.factor(district)), show.legend = FALSE) +
scale_fill_brewer("District", palette = "Set3") +
theme_bw()
ggplot() +
geom_spatvector(data = mwgrid, aes(fill = as.factor(district))) +
scale_fill_brewer("District", palette = "Set3") +
theme_bw()
ggplot() +
geom_spatvector(data = mwgrid, aes(fill = as.factor(district))) +
scale_fill_brewer("District", palette = "Set3") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(4326))
indiaroads <- vect("week4files/indiaprimaryroads.shp")
indiadistricts <- vect("week4files/india_2011_district.shp")
ggplot() +
geom_spatvector(data = indiaroads, color = "green") +
geom_spatvector(data = indiadistricts, fill = NA) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(4326))
indiaroads <- vect("week4files/indiaprimaryroads.shp")
indiaroads <- vect("week4files/indiaprimaryroads.shp")
indiadistricts <- vect("week4files/india_2011_district.shp")
ggplot() +
geom_spatvector(data = indiaroads, color = "red") +
geom_spatvector(data = indiadistricts, fill = NA) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
coord_sf(datum = sf::st_crs(4326))
indiadistricts
indiaroads
roadsint <- intersection(indiaroads, indiadistricts)
roadsint <- intersects(indiaroads, indiadistricts)
roadsint <- intersect(indiaroads, indiadistricts)
roadsint
dim(indiaroads)
dim(roadsint)
perim(roadsint)
?periom
?perim
roadsint
names(roadsint)
length(unique(indiadistricts$dt_cen-cd))
length(unique(indiadistricts$dt_cen_cd))
indiadistricts
length(unique(indiadistricts$cartodb_id))
# Note: This can take some time
roadsint$length <- perim(roadsint)
roadsint$length
roadsint <- roadsint |>
group_by(cartodb_id) |>
summarize(length = sum(length)) |>
ungroup()
roadsint
# finally, turn it into a tibble
roadsint <- as_tibble(roadsint)
roadsint
roadsint <- roadsint |>
arrange(cartodb_id)
# Note: This can take some time
roadsint <- intersect(indiaroads, indiadistricts)
# Note: This can take some time
roadsint$length <- perim(roadsint)
roadsint <- roadsint |>
group_by(cartodb_id) |>
summarize(length = sum(length)) |>
ungroup() |>
# let's put it in km (default is m)
mutate(length = length/1000)
roadsint
# Note: This can take some time
roadsint <- intersect(indiaroads, indiadistricts)
roadsint$length <- perim(roadsint)
roadsint <- roadsint |>
as_tibble() |>
group_by(cartodb_id) |>
summarize(length = sum(length)) |>
ungroup() |>
# let's put it in km (default is m)
mutate(length = length/1000)
roadsint
indiadistricts <- indiadistricts |>
arrange(cartodb_id)
roadsint
indiadistricts <- indiadistricts |>
left_join(roadsint, by = "cartodb_id")
indiadistricts
# if missing? zero!
indiadistricts$length <- ifelse(is.na(indiadistricts$length), 0, indiadistricts$length)
ggplot() +
geom_spatvector(data = indiadistricts, aes(fill = length)) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = indiadistricts, aes(fill = log(length))) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw()
plants <- vect("week4files/plants.shp")
plants
plants <- plants[,"unit_id"]
plants
length(unique(plants$unit_id))
writeVector("week4files/plants.shp", overwrite = TRUE)
writeVector(plants, "week4files/plants.shp", overwrite = TRUE)
plants <- vect("week4files/plants.shp")
plants
# create buffer
plantsbuffer <- buffer(plants, 50000)
ggplot() +
geom_spatvector(data = plantsbuffer, fill = "gray", alpha = 0.5) +
geom_spatvector(data = indiadistricts, fill = NA, color = "black") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = plantsbuffer, fill = "black", alpha = 0.5) +
geom_spatvector(data = indiadistricts, fill = NA, color = "gray") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
plantsbuffer
plants <- vect("week4files/plants.shp")
# create buffer
plantsbuffer <- buffer(plants, 50000)
# roads
indiaroads <- vect("week4files/indiaprimaryroads.shp")
# intersection
roadsint <- intersect(indiaroads, plantsbuffer)
indiaroads <- project(indiaroads, crs(plants))
indiaroads
# intersection
roadsint <- intersect(indiaroads, plantsbuffer)
roadsint
roadsint$area <- perim(roadsint)
roadsint
roadsint <- roadsint |>
group_by(unit_id) |>
summarize(length = sum(area)) |>
ungroup()
roadsint
indiadistricts <- indiadistricts |>
left_join(roadsint, by = c("unit_id"))
roadsint
roadsint <- as_tibble(roadsint) |>
group_by(unit_id) |>
summarize(length = sum(area)) |>
ungroup()
# intersection
roadsint <- intersect(indiaroads, plantsbuffer)
roadsint$area <- perim(roadsint)
roadsint <- as_tibble(roadsint) |>
group_by(unit_id) |>
summarize(length = sum(area)) |>
ungroup()
indiadistricts <- indiadistricts |>
left_join(roadsint, by = c("unit_id"))
indiadistricts
indiadistricts <- plantsbuffer |>
left_join(roadsint, by = c("unit_id"))
plantsbuffer <- plantsbuffer |>
left_join(roadsint, by = c("unit_id"))
plantsbuffer
indiadistricts <- vect("week4files/india_2011_district.shp")
ggplot() +
geom_spatvector(data = plantsbuffer, aes(fill = length)) +
geom_spatvector(data = indiadistricts, fill = NA) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = plantsbuffer, aes(fill = length/1000)) +
geom_spatvector(data = indiadistricts, fill = NA) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = plantsbuffer, aes(fill = length/1000)) +
geom_spatvector(data = indiadistricts, fill = NA, alpha = 0.5) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = plantsbuffer, aes(fill = length/1000)) +
geom_spatvector(data = indiadistricts, fill = NA, color = "gray", alpha = 0.5) +
scale_fill_distiller("Length of\nprimary roads\n(km)", palette = "Spectral") +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
# mw3
mw3 <- vect("week4files/mw3allcountry.shp")
# first aggregate to ID_1
mw3 <- aggregate(mw3, "ID_1")
# first aggregate to ID_1
mw3 <- aggregate(mw3, "ID_1")
# create centroids
mw3centroids <- centroids(mw3)
# now aggregate mw3 to country level
mw3 <- aggregate(mw3)
# bnd stands for "boundary"
voronoi <- voronoi(mw3centroids, bnd = mw3)
voronoi <- intersect(voronoi, mw3)
ggplot() + geom_spatvector(data = voronoi)
?terra::merge
# mw3
mw3 <- vect("week4files/mw3allcountry.shp")
# first aggregate to ID_1
mw3 <- aggregate(mw3, "ID_1")
# create centroids
mw3centroids <- centroids(mw3)
# now aggregate mw3 to country level
mw3 <- aggregate(mw3)
# bnd stands for "boundary"
voronoi1 <- voronoi(mw3centroids, bnd = mw3)
# why did I do it this way?
voronoi2 <- intersect(voronoi1, mw3)
voronoi1
voronoi2
ggplot() +
geom_spatvector(data = voronoi) +
geom_spatvector(data = mw3centroids) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
# plants
plants <- vect("week4files/plants.shp")
# districts
indiadistricts <- vect("week4files/india_2011_district.shp")
# aggregate to india
india <- aggregate(indiadistricts)
plants <- vect("week4files/plants.shp")
# districts
indiadistricts <- vect("week4files/india_2011_district.shp")
# aggregate to india
india <- aggregate(indiadistricts)
# bnd stands for "boundary"
voronoi <- voronoi(plants, bnd = india)
# why did I do it this way?
voronoi <- intersect(voronoi, india3)
# why did I do it this way?
voronoi <- intersect(voronoi, india)
# districts
indiadistricts <- vect("week4files/india_2011_district.shp")
indiadistricts <- project(indiadistricts, crs(plants))
# aggregate to india
india <- aggregate(indiadistricts)
# aggregate to india
india <- aggregate(indiadistricts)
# bnd stands for "boundary"
voronoi <- voronoi(plants, bnd = india)
# bnd stands for "boundary"
voronoi <- voronoi(plants, bnd = india)
# why did I do it this way?
voronoi <- intersect(voronoi, india)
ggplot() +
geom_spatvector(data = voronoi) +
geom_spatvector(data = plants) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = voronoi) +
geom_spatvector(data = plants, size = 0.5) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
ggplot() +
geom_spatvector(data = voronoi) +
geom_spatvector(data = plants, size = 0.5) +
theme_bw() +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(plot.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb")) +
theme(legend.background = element_rect(fill = "#f0f1eb", color = "#f0f1eb"))
plants <- vect("week4files/plants.shp")
# districts
indiadistricts <- vect("week4files/india_2011_district.shp")
indiadistricts <- project(indiadistricts, crs(plants))
extract(plants, indiadistricts)
extract(indiadistricts, plants)
dim(extract(indiadistricts, plants))
plantsextract <- extract(indiadistricts, plants)
plantsextract
plants <- cbind(plants, plantsextract)
plants
